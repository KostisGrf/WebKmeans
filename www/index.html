<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
   <div class="container mt-5">
    <h2 class="text-center mb-3">Upload dataset</h2>
    <div class="card">
        <div class="card-header">Upload dataset</div>
        <div class="card-body">
            <table width="50%" class="table">
                <tr>
                    <th width="50%" class="text-right"><b>select file</b></th>
                    <th width="50%">
                        <input type="file" name="sample_dataset"  />
                    </th>
                     <th width="50%">
                        <a href="http://webkmeans.localhost/backend/api/download-dataset?file=fuel_prices_52.csv&dataset-type=personal&apikey=5550c5cf404cfb7ad66fd904efce3c0c">Download file</a>
                    </th>
            </tr>
            </table>
        </div>
    </div>
</div>   
    <div class="text-center mt-5" id="uploaded_dataset"></div>
</body>
</html>

<script>
    const sample_dataset=document.getElementsByName('sample_dataset')[0];
    
    sample_dataset.addEventListener('change',()=>{
        upload_dataset(sample_dataset.files[0],"sample");
        // console.log(sample_dataset.files[0]);
    })


    
    var allowedExtensions = /(\.csv|\.xlsx|\.xls)$/i;

    const upload_dataset=(file,dataset)=>{
        if(!allowedExtensions.exec(file.name)){
            document.getElementById('uploaded_dataset').innerHTML='<div class="alert alert-danger"><p>invalid file type<p>only csv,xlsx</div>'
            document.getElementsByName('sample_dataset')[0].value='';
            document.getElementsByName('public_dataset')[0].value='';
            return;
        }
        const form_data=new FormData();
        form_data.set("dataset",file);
        form_data.set('email',"kostisgratsos@hotmail.gr");
        form_data.set('apikey',"5550c5cf404cfb7ad66fd904efce3c0c");
        form_data.set("dataset-type","personal");

        var upload_url;

        
        fetch("http://webkmeans.localhost/backend/api/upload-dataset",{
            method:'POST',
            body:form_data,
        }).then(function(response){
            // console.log(response);
           return response.json()
        }).then(function(responseData){
            console.log(JSON.stringify({error:responseData}));
            document.getElementsByName('sample_dataset')[0].value='';
        })
    }


</script>